<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aysoot - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Kanit', sans-serif; background-color: #fdf6e3; }
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .ingredient-row { transition: all 0.3s; }
        .ingredient-row:hover { background-color: #f9fafb; }
    </style>
</head>
<body class="text-gray-800">

    <nav class="bg-orange-500 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold"><i class="fas fa-utensils mr-2"></i>Aysoot Recipe</h1>
            <div class="space-x-4">
                <button onclick="showSection('create')" class="hover:bg-orange-600 px-3 py-1 rounded transition">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏ï‡∏£</button>
                <button onclick="showSection('view')" class="hover:bg-orange-600 px-3 py-1 rounded transition">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏π‡∏ï‡∏£</button>
                <button onclick="showSection('compare')" class="hover:bg-orange-600 px-3 py-1 rounded transition">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-6 max-w-4xl">

        <div id="create-section" class="glass-card p-8 mb-6 animate-fade-in">
            <h2 class="text-2xl font-bold mb-4 text-orange-600">üìù ‡∏à‡∏î‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà</h2>
            
            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏≠‡∏≤‡∏´‡∏≤‡∏£/‡∏Ç‡∏ô‡∏°</label>
                <input type="text" id="recipeName" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏Å‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏ß‡∏≤‡∏ô, ‡πÄ‡∏Ñ‡πâ‡∏Å‡∏™‡πâ‡∏°">
            </div>

            <div class="mb-4">
                <label class="block text-sm font-bold mb-2">‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏° & ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á</label>
                <div id="ingredientsList" class="space-y-2">
                    </div>
                <button onclick="addIngredientRow()" class="mt-2 text-orange-500 hover:text-orange-700 font-bold text-sm">
                    <i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
                </button>
            </div>

            <div class="mb-6">
                <label class="block text-sm font-bold mb-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥ / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                <textarea id="recipeSteps" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-400" rows="3" placeholder="‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ..."></textarea>
            </div>

            <button onclick="saveRecipe()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 rounded-lg shadow transition">
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏π‡∏ï‡∏£ & ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö
            </button>
        </div>

        <div id="view-section" class="glass-card p-8 mb-6 hidden">
            <h2 class="text-2xl font-bold mb-4 text-green-600">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏™‡∏π‡∏ï‡∏£</h2>
            <div class="flex gap-2 mb-6">
                <input type="text" id="searchCode" class="flex-1 p-3 border rounded-lg" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏π‡∏ï‡∏£ (‡πÄ‡∏ä‡πà‡∏ô eyr59040)">
                <button onclick="fetchRecipe('searchCode', 'viewResult')" class="bg-green-500 text-white px-6 rounded-lg hover:bg-green-600">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
            </div>
            <div id="viewResult" class="hidden border-t pt-4">
                </div>
        </div>

        <div id="compare-section" class="glass-card p-8 mb-6 hidden">
            <h2 class="text-2xl font-bold mb-4 text-blue-600">‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏™‡∏π‡∏ï‡∏£</h2>
            <p class="text-sm text-gray-500 mb-4">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£ 2 ‡∏≠‡∏±‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                <input type="text" id="codeA" class="p-3 border rounded-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà 1">
                <input type="text" id="codeB" class="p-3 border rounded-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏π‡∏ï‡∏£‡∏ó‡∏µ‡πà 2">
            </div>
            <button onclick="compareRecipes()" class="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 mb-6">‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="compareResult">
                <div id="resultA" class="bg-white p-4 rounded shadow hidden"></div>
                <div id="resultB" class="bg-white p-4 rounded shadow hidden"></div>
            </div>
        </div>

    </div>

    <datalist id="commonIngredients">
        <option value="‡πÄ‡∏Å‡∏•‡∏∑‡∏≠">
        <option value="‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ó‡∏£‡∏≤‡∏¢">
        <option value="‡πÅ‡∏õ‡πâ‡∏á‡∏™‡∏≤‡∏•‡∏µ">
        <option value="‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà">
        <option value="‡∏ô‡∏°‡∏™‡∏î">
        <option value="‡πÄ‡∏ô‡∏¢‡πÄ‡∏Ñ‡πá‡∏°">
        <option value="‡∏ú‡∏á‡∏ü‡∏π">
        <option value="‡∏ô‡πâ‡∏≥‡∏õ‡∏•‡∏≤">
        <option value="‡∏û‡∏£‡∏¥‡∏Å‡πÑ‡∏ó‡∏¢">
        <option value="‡∏Å‡∏£‡∏∞‡πÄ‡∏ó‡∏µ‡∏¢‡∏°">
    </datalist>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDVS3zsJSeqOs5Wwpkj-DNbN1vhfc2_3LE",
            authDomain: "aysoot.firebaseapp.com",
            projectId: "aysoot",
            storageBucket: "aysoot.firebasestorage.app",
            messagingSenderId: "56310141842",
            appId: "1:56310141842:web:a08f702a98a39a0eb7274b",
            measurementId: "G-SCDYFZ7TLP"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- Global Functions attached to window ---

        // 1. UI Navigation
        window.showSection = (id) => {
            ['create-section', 'view-section', 'compare-section'].forEach(sec => {
                document.getElementById(sec).classList.add('hidden');
            });
            document.getElementById(id + '-section').classList.remove('hidden');
        }

        // 2. Add Ingredient Row logic
        window.addIngredientRow = (data = {name: '', qty: '', unit: ''}) => {
            const div = document.createElement('div');
            div.className = 'flex gap-2 ingredient-row';
            div.innerHTML = `
                <input type="text" placeholder="‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏Å‡∏•‡∏∑‡∏≠)" list="commonIngredients" class="ing-name flex-1 p-2 border rounded" value="${data.name}">
                <input type="number" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" class="ing-qty w-20 p-2 border rounded" value="${data.qty}">
                <select class="ing-unit w-24 p-2 border rounded">
                    <option value="‡∏Å‡∏£‡∏±‡∏°" ${data.unit === '‡∏Å‡∏£‡∏±‡∏°' ? 'selected' : ''}>‡∏Å‡∏£‡∏±‡∏°</option>
                    <option value="‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞" ${data.unit === '‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞' ? 'selected' : ''}>‡∏ä‡πâ‡∏≠‡∏ô‡πÇ‡∏ï‡πä‡∏∞</option>
                    <option value="‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤" ${data.unit === '‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤' ? 'selected' : ''}>‡∏ä‡πâ‡∏≠‡∏ô‡∏ä‡∏≤</option>
                    <option value="‡∏ñ‡πâ‡∏ß‡∏¢" ${data.unit === '‡∏ñ‡πâ‡∏ß‡∏¢' ? 'selected' : ''}>‡∏ñ‡πâ‡∏ß‡∏¢</option>
                    <option value="‡∏ü‡∏≠‡∏á" ${data.unit === '‡∏ü‡∏≠‡∏á' ? 'selected' : ''}>‡∏ü‡∏≠‡∏á</option>
                    <option value="ml" ${data.unit === 'ml' ? 'selected' : ''}>ml</option>
                </select>
                <button onclick="this.parentElement.remove()" class="text-red-500 px-2"><i class="fas fa-trash"></i></button>
            `;
            document.getElementById('ingredientsList').appendChild(div);
        }

        // Initialize with one row
        window.addIngredientRow();

        // 3. Generate Random Code
        const generateCode = () => {
            return Math.random().toString(36).substring(2, 8).toUpperCase(); // e.g., 5GD82K
        }

        // 4. Save Recipe
        window.saveRecipe = async () => {
            const name = document.getElementById('recipeName').value;
            const steps = document.getElementById('recipeSteps').value;
            
            if(!name) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏≤‡∏´‡∏≤‡∏£");

            const ingredients = [];
            document.querySelectorAll('#ingredientsList .ingredient-row').forEach(row => {
                const iName = row.querySelector('.ing-name').value;
                const iQty = row.querySelector('.ing-qty').value;
                const iUnit = row.querySelector('.ing-unit').value;
                if(iName) ingredients.push({ name: iName, qty: iQty, unit: iUnit });
            });

            const recipeCode = generateCode();
            
            try {
                await setDoc(doc(db, "recipes", recipeCode), {
                    name: name,
                    ingredients: ingredients,
                    steps: steps,
                    createdAt: new Date()
                });

                alert(`‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\n‡∏£‡∏´‡∏±‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡∏π‡∏™‡∏π‡∏ï‡∏£‡∏Ñ‡∏∑‡∏≠: ${recipeCode}\n(‡∏à‡∏î‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô)`);
                // Reset form
                document.getElementById('recipeName').value = '';
                document.getElementById('recipeSteps').value = '';
                document.getElementById('ingredientsList').innerHTML = '';
                window.addIngredientRow();
            } catch (e) {
                console.error("Error adding document: ", e);
                alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å");
            }
        }

        // 5. Fetch and Render Recipe
        window.fetchRecipe = async (inputId, outputId) => {
            const code = document.getElementById(inputId).value.trim().toUpperCase();
            if(!code) return;

            const outputDiv = document.getElementById(outputId);
            outputDiv.innerHTML = '<p class="text-center text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</p>';
            outputDiv.classList.remove('hidden');

            try {
                const docRef = doc(db, "recipes", code);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    let ingHtml = data.ingredients.map(ing => 
                        `<li class="flex justify-between border-b py-1"><span>${ing.name}</span> <span class="font-bold">${ing.qty} ${ing.unit}</span></li>`
                    ).join('');

                    outputDiv.innerHTML = `
                        <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                            <h3 class="text-xl font-bold text-orange-800">${data.name}</h3>
                            <p class="text-xs text-gray-500 mb-2">Code: ${code}</p>
                            <h4 class="font-bold mt-2">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö:</h4>
                            <ul class="text-sm mb-3 text-gray-700">${ingHtml}</ul>
                            <h4 class="font-bold mt-2">‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏≥:</h4>
                            <p class="text-sm text-gray-700 whitespace-pre-line">${data.steps || '-'}</p>
                        </div>
                    `;
                } else {
                    outputDiv.innerHTML = '<p class="text-red-500 text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏π‡∏ï‡∏£‡∏à‡∏≤‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ</p>';
                }
            } catch (e) {
                console.error(e);
                outputDiv.innerHTML = '<p class="text-red-500 text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p>';
            }
        }

        // 6. Compare Function
        window.compareRecipes = async () => {
            await fetchRecipe('codeA', 'resultA');
            await fetchRecipe('codeB', 'resultB');
        }

    </script>
</body>
</html>
